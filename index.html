<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>緊急應變問答遊戲</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 800px;
      margin: auto;
      padding: 20px;
      background-size: cover;
      background-position: center;
      transition: background-image 0.5s ease-in-out;
    }
    .question {
      display: none;
      animation: bounceIn 0.8s;
      background: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 10px;
    }
    .question.active {
      display: block;
    }
    .options input {
      margin-right: 10px;
    }
    #next-btn, #submit-btn {
      margin-top: 20px;
      padding: 10px 20px;
    }
    #result {
      display: none;
    }
    @keyframes bounceIn {
      0% { transform: scale(0.8); opacity: 0; }
      60% { transform: scale(1.05); opacity: 1; }
      100% { transform: scale(1); }
    }
  </style>
</head>
<body>
  <h2>緊急應變問答遊戲</h2>
  <div id="quiz"></div>

  <div>
    <button id="next-btn" onclick="nextQuestion()">下一題</button>
    <button id="submit-btn" onclick="submitQuiz()" style="display:none;">送出</button>
  </div>

  <div id="result">
    <h3>答題結果</h3>
    <p id="scoreDisplay"></p>
    <button onclick="exportCSV()">匯出CSV</button>
  </div>

  <script>
    const questionsData = [
      {
        type: "info", html: `
          <label>請輸入員編：</label><br />
          <input type="text" id="empId" required /><br /><br />
          <label>請輸入姓名：</label><br />
          <input type="text" id="empName" required />
        `
      },
      {
        type: "text", question: "1. 你曾經處理過緊急情況嗎？若有，是甚麼情況請簡述"
      },
      {
        type: "multi", correct: ["0", "1"], question: "2. 當顧客失去意識時 CODE 500，第一時間你會做什麼？", options: [
          "A. 由值班經理撥打119 或 授權當區同仁撥打",
          "B. 開啟密錄器",
          "C. 通知家人",
          "D. 等待幫助"
        ]
      },
      {
        type: "single", correct: "2", question: "3. 你聽到第一次 CODE 1000廣播，要先趕往哪裡？", options: [
          "A. 緊急集合地點(文心森林公園)",
          "B. 中控室",
          "C. 火災現場",
          "D. 1F Greeting 入口"
        ]
      },
      {
        type: "single", correct: "1", question: "4. 疏散後到達集合地點，你會做什麼？", options: [
          "A. 等待指示",
          "B. 清點人數",
          "C. 通知媒體",
          "D. 拍照"
        ]
      },
      {
        type: "single", correct: "0", question: "5. 颱風海上警報發布後，你會做什麼？", options: [
          "A. 召集應變小組",
          "B. 通知顧客",
          "C. 拍照",
          "D. 關閉店鋪"
        ]
      },
      {
        type: "multi", correct: ["1", "2", "3"], question: "6. 營業中賣場突然停電時，你會做什麼？", options: [
          "A. 通知媒體",
          "B. 確認發電機正常運作",
          "C. 確認POS正常結帳",
          "D. 安撫顧客",
          "E. 等待幫助",
          "F. 立即啟動CODE 1000疏散顧客"
        ]
      },
      {
        type: "single", correct: "3", question: "7. CODE 1000時，Smaland小朋友何時可被領走？", options: [
          "A. 疏散前",
          "B. 立即",
          "C. 隨時",
          "D. 點名後"
        ]
      },
      {
        type: "single", correct: "2", question: "8. 非轄區警察要求監視器影帶，你會怎麼做？", options: [
          "A. 通知MKT",
          "B. 等待總公司指示",
          "C. 婉轉拒絕",
          "D. 立即提供"
        ]
      },
      {
        type: "multi", correct: ["2", "3", "4"], question: "9. 顧客被賣場展示的破裂碗盤割傷，你會做什麼？", options: [
          "A. 等待幫助",
          "B. 通知媒體",
          "C. 確認現場其他商品",
          "D. 由客服陪同就醫",
          "E. 拍照",
          "F. 啟動保險承諾顧客賠償以示負責"
        ]
      },
      {
        type: "multi", correct: ["1", "2", "4"], question: "10. 員工工作中受傷住院，你會做什麼？", options: [
          "A. 疏散顧客",
          "B. 圍起現場確認有無其他危險",
          "C. 拍下現場照片",
          "D. 通知媒體",
          "E. 立刻通報HR及Safety",
          "F. 填寫CRM"
        ]
      }
    ];
{
  type: "multi", correct: ["0", "2", "4"], question: "11. 兩個顧客在賣場大打出手時，你會做什麼？", options: [
    "A. 開啟密錄器",
    "B. 通知MKT",
    "C. 保持距離口頭緩和雙方情緒",
    "D. 用肉身將兩人拉開",
    "E. 報警處理",
    "F. 讓保全去勸架"
  ]
},
{
  type: "multi", correct: ["0", "1", "2"], question: "12. 堆高機傾倒，無人受傷，你會做什麼？", options: [
    "A. 拍下現場照片",
    "B. 圍起現場",
    "C. 安撫員工",
    "D. 通知總公司"
  ]
},
{
  type: "multi", correct: ["1", "2"], question: "13. 小孩跌倒受傷，家屬質疑環境不安全，你會做什麼？", options: [
    "A. 承諾公司會負責",
    "B. 確認是否IKEA疏失造成受傷",
    "C. 開啟密錄器",
    "D. 通知媒體"
  ]
},
{
  type: "multi", correct: ["1", "2"], question: "14. 顧客一個人來逛，上廁所時地板濕滑跌倒受傷，第一時間你會做什麼？", options: [
    "A. 等待清潔",
    "B. 拍下現場照片",
    "C. 請客服陪同就醫",
    "D. 通知總公司"
  ]
},
{
  type: "order", correct: ["2", "1", "0", "3"], question: "15. 地震劇烈搖晃後，第一時間你會做什麼，請依照順序排列先後？", options: [
    "A. 經回報有安全疑慮且已明顯影響營運，啟動CODE1000疏散",
    "B. 前往中控室，使用CCTV觀察現場狀況",
    "C. 通知各區Duty檢查狀況",
    "D. 通報店經理。待餘震結束派EOT(各部門Duty)進入確認店內狀況安全回報後，再帶隊回店復原"
  ]
},
{
  type: "single", correct: "1", question: "17. 於停車場擦撞事故，顧客要求IKEA負責，你會怎麼做？", options: [
    "A. 通知總公司",
    "B. 通知警察",
    "C. 跟顧客要報價單",
    "D. 啟動保險賠償"
  ]
},
{
  type: "order", correct: ["1", "0", "2"], question: "18. 顧客拆封商品放包包內，且確認他帶了商品準備通過收銀檯，你會怎麼做？請依順序排列", options: [
    "甲、如不願配合待警方到場，待警員到場請顧客配合打開包包檢查",
    "乙、委婉詢問顧客是否有未結帳商品",
    "丙、報警並委婉請顧客主動打開包包"
  ]
},
{
  type: "single", correct: "1", question: "19. 顧客反應有全身髒臭的顧客在店內閒晃，你會怎麼做？", options: [
    "A. 通知保全驅離",
    "B. 通知警察到場協助",
    "C. 通知CR Duty驅離",
    "D. 不管他"
  ]
},
{
  type: "multi", correct: ["0", "1"], question: "20. 有顧客錄影直播消費/服務糾紛，你會怎麼做？", options: [
    "A. 明示拒絕錄影",
    "B. 開啟密錄器",
    "C. 通知警方到場",
    "D. 直播是他人自由不管他"
  ]
},
{
  type: "multi", correct: ["0", "2"], question: "21. 員工操作推車失誤撞到顧客，你會怎麼做？", options: [
    "A. 拍下現場照片",
    "B. 啟動保險理賠",
    "C. 請CR Duty陪同就醫",
    "D. 通知警察到場"
  ]
}
function submitQuiz() {
  score = 0;
  const name = document.getElementById("empName").value.trim();
  const id = document.getElementById("empId").value.trim();
  const totalQuestions = questionsData.length - 1;

  for (let i = 1; i <= totalQuestions; i++) {
    const q = document.getElementById(`q${i}`);
    const type = q.dataset.type;
    const correct = q.dataset.correct;

    if (type === "text") continue; // 不計分

    if (type === "single") {
      const selected = q.querySelector("input[type='radio']:checked");
      if (selected && selected.value === correct) {
        score++;
      }
    }

    if (type === "multi") {
      const selected = [...q.querySelectorAll("input[type='checkbox']:checked")].map(e => e.value);
      const correctSet = correct.split(",");
      if (
        selected.length === correctSet.length &&
        selected.every(ans => correctSet.includes(ans))
      ) {
        score++;
      }
    }

    if (type === "order") {
      const selected = [...q.querySelectorAll("input[type='checkbox']:checked")].map(e => e.value);
      const correctOrder = correct.split(",");
      if (selected.join(",") === correctOrder.join(",")) {
        score++;
      }
    }
  }

  document.getElementById("quiz").style.display = "none";
  document.getElementById("next-btn").style.display = "none";
  document.getElementById("submit-btn").style.display = "none";
  document.getElementById("result").style.display = "block";
  document.getElementById("scoreDisplay").innerText = `員編：${id}，姓名：${name}，得分：${score} / ${totalQuestions}`;
  quizExport.push({ id, name, score });
}
